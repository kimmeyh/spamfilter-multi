{
  "project_overview": {
    "name": "SpamFilter-multi",
    "description": "100% Flutter/Dart unified spam & phishing filter for all platforms (Windows, macOS, Linux, Android, iOS) with shared YAML rules and IMAP/OAuth email provider support",
    "purpose": "Automated processing and removal of SPAM and phishing emails using intelligent filtering rules across all desktop and mobile platforms with single codebase",
    "type": "Email Security Tool",
    "repository_type": "Flutter monorepo (100% Dart for all 5 platforms)",
    "license": "MIT License",
    "current_phase": "Phase 2.0 âœ… COMPLETE | Phase 2 ðŸ”„ READY (UI Development)",
    "last_updated": "2025-12-11",
    "architecture_decision_date": "2025-12-11",
    "architecture_note": "Unified Flutter approach (100% Dart) replaces previous Python desktop + Flutter mobile hybrid model",
    "status_url": "See PHASE_2.0_COMPLETE.md for detailed Phase 2.0 completion report"
  },
  "platforms": {
    "overview": "100% Flutter/Dart - Single codebase for all 5 platforms",
    "supported_platforms": [
      {
        "name": "Windows",
        "type": "Desktop",
        "build_command": "flutter build windows",
        "installer": "MSIX",
        "status": "Ready - Phase 2.5"
      },
      {
        "name": "macOS",
        "type": "Desktop",
        "build_command": "flutter build macos",
        "installer": "DMG",
        "status": "Ready - Phase 2.5"
      },
      {
        "name": "Linux",
        "type": "Desktop",
        "build_command": "flutter build linux",
        "installer": "AppImage/Snap",
        "status": "Ready - Phase 2.5"
      },
      {
        "name": "Android",
        "type": "Mobile",
        "build_command": "flutter build apk --release",
        "installer": "APK/AAB",
        "status": "Ready now"
      },
      {
        "name": "iOS",
        "type": "Mobile",
        "build_command": "flutter build ios --release",
        "installer": "IPA",
        "status": "Ready - Phase 2.5"
      }
    ],
    "email_providers": {
      "phase_2_priority": [
        {
          "provider": "AOL",
          "protocol": "IMAP",
          "auth": "App Password",
          "status": "Ready for Phase 2 live testing"
        },
        {
          "provider": "Gmail",
          "protocol": "IMAP/OAuth 2.0",
          "auth": "Google OAuth 2.0",
          "status": "Framework ready - Phase 2+"
        },
        {
          "provider": "Outlook.com",
          "protocol": "IMAP/OAuth 2.0",
          "auth": "Microsoft OAuth 2.0",
          "status": "Framework ready - Phase 2+"
        }
      ],
      "future_support": [
        {
          "provider": "Yahoo",
          "protocol": "IMAP",
          "auth": "App Password",
          "status": "Phase 2+"
        },
        {
          "provider": "ProtonMail",
          "protocol": "IMAP",
          "auth": "Bridge Password",
          "status": "Phase 3"
        },
        {
          "provider": "Custom IMAP",
          "protocol": "IMAP",
          "auth": "Configurable",
          "status": "Generic handler ready"
        }
      ]
    },
    "desktop": {
      "language": "Dart/Flutter",
      "platforms": ["Windows", "macOS", "Linux"],
      "status": "Production Ready (Phase 2.5)",
      "deployment": "Desktop installers (MSIX, DMG, AppImage)"
    },
    "mobile": {
      "language": "Dart/Flutter",
      "targets": ["Android", "iOS"],
      "status": "Production Ready (backend) - UI in Phase 2",
      "phase_2_0_components": [
        {
          "component": "AppPaths",
          "file": "lib/adapters/storage/app_paths.dart",
          "lines": 190,
          "status": "âœ… Complete Dec 11",
          "description": "Platform-agnostic file system path management (iOS, Android, Windows, macOS, Linux)"
        },
        {
          "component": "LocalRuleStore",
          "file": "lib/adapters/storage/local_rule_store.dart",
          "lines": 200,
          "status": "âœ… Complete Dec 11",
          "description": "YAML file persistence with automatic backups"
        },
        {
          "component": "SecureCredentialsStore",
          "file": "lib/adapters/storage/secure_credentials_store.dart",
          "lines": 310,
          "status": "âœ… Complete Dec 11",
          "description": "Encrypted credential storage using platform-native encryption (Keychain/Keystore/Credential Manager)"
        },
        {
          "component": "RuleSetProvider",
          "file": "lib/core/providers/rule_set_provider.dart",
          "lines": 210,
          "status": "âœ… Complete Dec 11",
          "description": "Rule state management with async initialization"
        },
        {
          "component": "EmailScanProvider",
          "file": "lib/core/providers/email_scan_provider.dart",
          "lines": 260,
          "status": "âœ… Complete Dec 11",
          "description": "Real-time scan progress and results tracking"
        }
      ],
      "phase_2_next": [
        "Platform Selection Screen (AOL, Gmail, Outlook, Yahoo)",
        "Account Setup Forms with SecureCredentialsStore integration",
        "Scan Progress Screen bound to EmailScanProvider",
        "Results Display Screen with summary metrics"
      ]
    }
  },
  "repository_structure": {
    "shared": ["rules.yaml", "rules_safe_senders.yaml", "memory-bank/", "README.md", "LICENSE"],
    "flutter_only": ["mobile-app/lib/", "mobile-app/test/", "mobile-app/android/", "mobile-app/ios/", "mobile-app/windows/", "mobile-app/macos/", "mobile-app/linux/", "mobile-app/pubspec.yaml"],
    "archived_reference": ["Archive/desktop-python/ (legacy Outlook COM implementation)"]
  },
  "quick_reference_dashboard": {
    "current_status": {
      "phase_2_0": "âœ… COMPLETE (Dec 11, 2025)",
      "architecture": "100% Flutter for all 5 platforms (NEW)",
      "tests_passing": "50+ (27 Phase 1 regression + 23 Phase 2.0 new)",
      "code_quality": "0 issues (flutter analyze)",
      "performance": "19.58ms per email"
    },
    "immediate_next_actions": [
      "1. Verify: flutter test (confirm 50+ pass)",
      "2. Read: PHASE_2.0_COMPLETE.md (15 min overview)",
      "3. Begin: Phase 2 UI screens using providers"
    ],
    "quick_links": {
      "new_users": ["README.md", "PHASE_2.0_COMPLETE.md", "NEXT_STEPS.md"],
      "developers": ["mobile-app/IMPLEMENTATION_SUMMARY.md", "memory-bank/mobile-app-plan.md"],
      "qa_testers": ["TEST_GUIDE.md", "mobile-app/PHASE_2.0_TESTING_CHECKLIST.md"],
      "full_documentation": "DOCUMENTATION_INDEX.md"
    },
    "command_cheat_sheet": {
      "flutter_tests": "cd mobile-app && flutter test",
      "flutter_quality": "cd mobile-app && flutter analyze",
      "flutter_run": "cd mobile-app && flutter run",
      "flutter_build_android": "cd mobile-app && flutter build apk --release",
      "flutter_build_windows": "cd mobile-app && flutter build windows",
      "desktop_setup": "./.venv/Scripts/Activate.ps1",
      "desktop_run_reference": "python withOutlookRulesYAML.py (reference only)"
    },
    "key_files_to_know": {
      "flutter_entry": "mobile-app/lib/main.dart (MultiProvider setup with async init)",
      "flutter_storage": "mobile-app/lib/adapters/storage/ (3 files: AppPaths, LocalRuleStore, SecureCredentialsStore)",
      "flutter_providers": "mobile-app/lib/core/providers/ (2 files: RuleSetProvider, EmailScanProvider)",
      "flutter_tests": "mobile-app/test/unit/ (23 Phase 2.0 tests + 27 Phase 1 regression tests)",
      "shared_rules": "rules.yaml and rules_safe_senders.yaml (used by all platforms)",
      "legacy_desktop": "Archive/desktop-python/withOutlookRulesYAML.py (Outlook COM - archived)"
    }
  },
  "architecture": {
    "pattern": "100% Flutter/Dart with Provider pattern for reactive state management",
    "platforms": "All 5 platforms (Windows, macOS, Linux, Android, iOS) from single codebase",
    "email_access": "IMAP/OAuth protocols (universal provider support)",
    "state_management": "Provider 6.1.0 with ChangeNotifier for reactive updates",
    "storage_layer": "Platform-agnostic abstraction for file paths + encrypted credential storage",
    "initialization": "Async MultiProvider in main.dart with TestWidgetsFlutterBinding for tests",
    "components": [
      {
        "component": "Rule Engine",
        "description": "Pattern compiler and rule evaluator for email filtering"
      },
      {
        "component": "Storage Layer",
        "description": "AppPaths (file management) + LocalRuleStore (YAML persistence) + SecureCredentialsStore (encrypted credentials)"
      },
      {
        "component": "State Management",
        "description": "RuleSetProvider (rule state) + EmailScanProvider (scan progress)"
      },
      {
        "component": "Email Adapters",
        "description": "Platform-specific adapters for AOL (IMAP), Gmail (OAuth), Outlook (OAuth), Yahoo (IMAP), ProtonMail (IMAP)"
      },
      {
        "component": "UI Framework",
        "description": "Flutter widgets for all platforms with responsive layouts"
      }
    ]
  },
  "key_features": [
    "YAML-based rule configuration for easy maintenance",
    "Multi-criteria filtering (header, body, subject, sender)",
    "Phishing detection with suspicious URL and domain analysis",
    "Safe sender whitelist management",
    "Automatic email deletion with safety checks",
    "Comprehensive logging and audit trails",
    "Interactive rule updates based on unmatched emails",
    "Backup and restore functionality for rules",
    "Cross-platform rule sharing capability",
    "IMAP/OAuth support for multiple email providers",
    "Encrypted credential storage (Keychain/Keystore/Credential Manager)",
    "Multi-account support with account tracking",
    "Platform-agnostic file system access",
    "Real-time scan progress tracking",
    "Result categorization and summary reporting"
  ],
  "file_structure": {
    "configuration_files": [
      "rules.yaml - Main spam filtering rules (contains regex patterns as of 11/10/2025)",
      "rules_safe_senders.yaml - Trusted sender whitelist (contains regex patterns as of 11/10/2025)",
      "requirements.txt - Python dependencies",
      "pytest.ini - Pytest configuration"
    ],
    "deprecated_files": [
      "rulesregex.yaml - DEPRECATED 11/10/2025: Consolidated to rules.yaml",
      "rules_safe_sendersregex.yaml - DEPRECATED 11/10/2025: Consolidated to rules_safe_senders.yaml"
    ],
    "main_scripts": [
      "withOutlookRulesYAML.py - Primary application script"
    ],
    "test_files": [
      "pytest/ - All test files organized in dedicated directory",
      "pytest/test_withOutlook_rulesYAML_compare_inport_to_export.py",
      "pytest/test_withOutlook_rulesYAML_compare_safe_senders_mport_to_export.py",
      "pytest/test_file_content.py",
      "pytest/test_folder_list_changes.py",
      "pytest/test_import_compatibility.py",
      "pytest/test_second_pass_implementation.py"
    ],
    "backup_files": [
      "archive/ - Timestamped rule backups and historical files",
      "archive/rules_backup_*.yaml - Timestamped rule backups",
      "archive/rules_safe_senders_backup_*.yaml - Safe sender backups"
    ],
    "documentation": [
      "memory-bank/ - GitHub Copilot memory enhancement files",
      "README.md - User documentation",
      "LICENSE - Project license"
    ]
  },
  "configuration": {
    "target_account": "kimmeyharold@aol.com",
    "target_folders": ["Bulk Mail", "bulk"], 
    "processing_days_back": "configurable (default varies)",
    "rule_name_prefix": "SpamAutoDelete",
    "log_locations": [
      "D:/data/harold/OutlookRulesProcessing/OutlookRulesProcessingDEBUG_INFO.log",
      "D:/data/harold/OutlookRulesProcessing/OutlookRulesProcessingSimple.log"
    ],
    "active_mode": "regex (only mode as of 10/14/2025)",
    "active_files": {
      "rules": "rules.yaml (contains regex patterns)",
      "safe_senders": "rules_safe_senders.yaml (contains regex patterns)"
    },
    "cli_flags": {
      "update_rules": "-u, --update_rules (enable interactive prompts during processing)",
      "deprecated": [
        "--use-regex-files (DEPRECATED 11/10/2025: regex is now the only mode)",
        "--use-legacy-files (DEPRECATED 10/14/2025: legacy wildcard mode removed)",
        "--convert-rules-to-regex (DEPRECATED 11/10/2025: conversion no longer needed)",
        "--convert-safe-senders-to-regex (DEPRECATED 11/10/2025: conversion no longer needed)"
      ]
    }
  },
  "rule_types": {
    "SpamAutoDeleteHeader": "Filters based on email headers and sender domains",
    "SpamAutoDeleteBody": "Filters based on email body content and embedded URLs", 
    "SpamAutoDeleteSubject": "Filters based on email subject patterns",
    "Safe Senders": "Whitelist of trusted email addresses and domains"
  },
  "dependencies": [
    "win32com.client - Outlook COM interface",
    "yaml - YAML file processing",
    "IPython - Interactive development support",
    "logging - Application logging",
    "re - Regular expression support"
  ],
  "development_standards": {
    "feature_enhancement_process": {
      "code_modification_principles": [
        "ONLY change code that HAS to be CHANGED to implement the recommendation",
        "Any code that should be removed should be commented out and not deleted",
        "Do not remove any commented out code - preserve for reference and rollback capability",
        "Maintain backward compatibility whenever possible"
      ],
      "testing_requirements": [
        "Before confirming changes, all tests should run successfully (without errors, warnings or skipped tests)",
        "Updates must be applied until all tests can be run without errors or warnings",
        "For all new features added, ensure an existing test covers the features or a new test is added to cover the features",
        "Create comprehensive test coverage for new functionality",
        "Validate both positive and negative test cases",
        "Ensure import compatibility and syntax validation",
        "NEVER skip tests - if a test cannot run, fix the underlying issue rather than skipping",
        "Tests should fail fast and provide clear error messages when prerequisites are not met",
        "All test dependencies and prerequisites must be properly configured before running tests"
      ],
      "post_testing_update_steps": [
        "Always update memory-bank files for enhancements after all tests pass (See <attachments> above for file contents. You may not need to search or read the file again.)",
        "Always update requirements_freeze_current.txt after all tests pass (See <attachments> above for file contents. You may not need to search or read the file again.)",
        "Always update README.md after all tests pass (See <attachments> above for file contents. You may not need to search or read the file again.)"
      ],
      "code_quality_standards": [
        "Preserve existing functionality while adding new features",
        "Use clear, descriptive variable and method names",
        "Add comprehensive logging for new functionality",
        "Document all changes in code comments and change logs",
        "Follow existing code patterns and conventions",
        "Write robust tests that fail clearly when prerequisites are not met",
        "Never implement test skipping logic - address root causes instead"
      ],
      "validation_checklist": [
        "Syntax validation - code compiles without errors",
        "Import compatibility - all imports work correctly", 
        "Functional testing - new features work as expected",
        "Regression testing - existing features still work",
        "Error handling - graceful handling of edge cases"
      ]
    },
    "change_management": {
      "documentation_requirements": [
        "Update change log with timestamp and description",
        "Update comments in code to reflect modifications",
        "Update memory-bank documentation",
        "Update README.md for user-facing changes"
      ],
      "backup_strategy": [
        "Create timestamped backups before major changes",
        "Preserve commented-out code for reference",
        "Maintain version history in change logs",
        "Use git branching for experimental features"
      ]
    }
  },
  "recent_development": {
    "current_branch": "feature/20251018_future_changes",
    "last_major_update": "November 2025",
    "key_improvements": [
      "Migrated from CSV to YAML rule configuration",
      "Memory bank integration for better rule learning",
      "Added comprehensive backup system",
      "Implemented safe sender management",
      "Enhanced phishing detection capabilities",
      "Added interactive rule update prompts with multiple options (d/e/s/sd/?)",
      "Implemented multi-folder processing support",
      "Added recursive folder search capability",
      "Implemented second-pass email reprocessing after rule updates",
      "Established REGEX-only mode (legacy wildcard mode deprecated 10/14/2025)",
      "Consolidated YAML filenames (11/10/2025): rules.yaml and rules_safe_senders.yaml now contain regex patterns",
      "Enhanced interactive filtering to skip emails matching newly added rules during user input session (10/18/2025)",
      "Removed legacy --use-legacy-files flag and all wildcard matching code",
      "Simplified CLI with regex as the only supported mode"
    ],
    "development_methodology": {
      "followed_standards": true,
      "minimal_code_changes": true,
      "preserved_commented_code": true,
      "comprehensive_testing": true,
      "zero_errors_warnings": true,
      "backward_compatibility": false,
      "breaking_changes_note": "Legacy wildcard mode removed, regex-only mode with consolidated filenames"
    }
  },
  "future_enhancements": [
    "Move backup files to dedicated backup directory",
    "Update mail processing to use safe_senders list for all header exceptions",
    "Cross-platform email client support",
    "Machine learning-based spam detection",
    "Mobile app development for cloud email providers",
    "Different processing rules for different folders",
    "Email volume reporting and summary statistics",
    "Reprocess emails in multiple folders for additional cleanup passes"
  ],
  "usage_workflow": [
    "1. Activate Python virtual environment (PowerShell: ./.venv/Scripts/Activate.ps1 | bash: source .venv/bin/activate)",
    "2. Run main script (python .\\withOutlookRulesYAML.py)",
    "3. Optional: Use -u flag for interactive rule updates (python .\\withOutlookRulesYAML.py -u)",
    "4. System processes emails in configured folders (Bulk Mail, bulk)",
    "5. Applies filtering rules from rules.yaml (contains regex patterns)",
    "6. Checks against safe sender lists from rules_safe_senders.yaml (contains regex patterns)",
    "7. Performs phishing detection",
    "8. Takes configured actions (delete, move, flag)",
    "9. Logs all activities with folder-specific information",
    "10. If -u flag used, provides interactive prompts for unmatched emails with options: d (block domain), e (block email), s (allow literal), sd (allow domain), ? (help)",
    "11. During interactive session, automatically skips emails matching newly added rules or safe senders",
    "12. Creates timestamped backups in archive/ directory before updating rules",
    "13. Performs second-pass reprocessing of all bulk folders after rule updates",
    "14. Provides comprehensive summary including both passes with statistics"
  ],
  "interactive_prompt_options": {
    "d": "Add sender domain regex to SpamAutoDeleteHeader (blocks all emails from domain and subdomains)",
    "e": "Add full sender email address to SpamAutoDeleteHeader (blocks specific sender)",
    "s": "Add literal sender to safe_senders (allows this specific sender)",
    "sd": "Add sender-domain regex to safe_senders (allows sender from domain and all subdomains)",
    "?": "Display help message with option descriptions",
    "skip": "Press Enter to skip without adding rules"
  }
}
